<template>
  <div style="height: 100vh;">
    <!--  svg-start -->
    <!--  svg1  -->
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:absolute;width:0;height:0;visibility:hidden"><defs><symbol xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" viewBox="0 0 1024 1024" id="res-bad"> <!-- Generator: Sketch 3.4.4 (17249) - http://www.bohemiancoding.com/sketch --> <title>Shape</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="res-bad_Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" type="MSPage"> <path d="M512,0 C230.326,0 0,230.326 0,512 C0,793.674 230.573,1024 512,1024 C793.427,1024 1024,793.674 1024,512 C1024,230.326 793.674,0 512,0 L512,0 Z M240.694,373.755 L399.429,317.47 L414.735,363.634 L256,419.919 L240.694,373.755 L240.694,373.755 Z M681.103,757.878 C670.981,757.878 660.613,747.756 655.429,737.388 C645.307,727.266 593.959,711.714 507.063,711.714 C420.167,711.714 368.818,727.02 358.697,737.388 C358.697,747.51 348.575,757.878 333.023,757.878 C317.471,757.878 307.349,747.756 307.349,732.204 C307.349,660.613 481.39,660.613 501.879,660.613 C522.368,660.613 696.409,660.613 696.409,732.204 C706.531,742.572 696.409,757.878 681.103,757.878 L681.103,757.878 Z M768,419.919 L604.328,358.449 L619.634,312.285 L778.369,368.57 L768.001,419.918 L768,419.919 Z" id="res-bad_Shape" fill="#D0021B" type="MSShapeGroup"></path> </g> </symbol><symbol xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" viewBox="0 0 1146 885" id="choose"> <!-- Generator: Sketch 3.4.4 (17249) - http://www.bohemiancoding.com/sketch --> <title>Shape</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="choose_Page-1" stroke="none" stroke-width="1" type="MSPage"> <path d="M1001.309,14.473 C1019.927,-4.145 1047.854,-4.145 1066.473,14.473 L1131.637,79.637 C1150.255,98.255 1150.255,126.182 1131.637,144.801 L410.182,870.91 C391.564,889.528 363.637,889.528 345.018,870.91 L14.545,545.092 C-4.073,526.474 -4.073,498.547 14.545,479.928 L79.709,414.764 C98.327,396.146 126.254,396.146 144.873,414.764 L377.6,647.491 L1001.309,14.473 L1001.309,14.473 L1001.309,14.473 Z" id="choose_Shape" type="MSShapeGroup"></path> </g> </symbol><symbol xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" viewBox="0 0 982 854" id="notice"> <!-- Generator: Sketch 3.4.4 (17249) - http://www.bohemiancoding.com/sketch --> <title>notice</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="notice_Page-1" stroke="none" stroke-width="1" type="MSPage"> <g id="notice_notice" type="MSLayerGroup"> <path d="M461.467,21.667 C448.667,21.667 431.6,25.934 410.267,47.267 L214,256.334 L73.2,256.334 C34.8,256.334 0.667,290.467 0.667,333.134 L0.667,550.734 C0.667,589.134 34.8,623.267 73.2,623.267 L214,623.267 L406,815.267 C423.067,832.334 444.4,836.6 452.933,836.6 C478.533,836.6 508.4,815.267 508.4,768.333 L508.4,85.666 C516.933,38.733 487.067,21.666 461.467,21.666 L461.467,21.667 Z M431.6,712.867 L252.4,533.667 L86,533.667 L86,341.667 L252.4,341.667 L427.333,149.667 L431.6,712.867 L431.6,712.867 Z" id="notice_Shape" type="MSShapeGroup"></path> <path d="M649.2,0.333 L649.2,102.733 C794.267,145.4 888.133,273.4 888.133,427 C888.133,580.6 790,708.6 649.2,751.267 L649.2,853.667 C845.467,811 982,636.067 982,427 C982,217.933 841.2,43 649.2,0.333 L649.2,0.333 Z" id="notice_Shape" type="MSShapeGroup"></path> <path d="M772.933,427 C772.933,341.667 726,264.867 649.2,235 L649.2,623.267 C726,589.134 772.933,512.334 772.933,427 L772.933,427 Z" id="notice_Shape" type="MSShapeGroup"></path> </g> </g> </symbol><symbol xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" viewBox="0 0 547 987" id="arrow-right"> <!-- Generator: Sketch 3.4.4 (17249) - http://www.bohemiancoding.com/sketch --> <title>Shape</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="arrow-right_Page-1" stroke="none" stroke-width="1" type="MSPage"> <path d="M0,931.973 L51.2,986.586 L546.133,491.653 L51.2,0.133 L4.26325641e-14,51.333 L440.32,491.653 L0,931.973 Z" id="arrow-right_Shape" type="MSShapeGroup"></path> </g> </symbol><symbol xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" viewBox="0 0 188 163" id="res-collection"> <!-- Generator: Sketch 3.4.4 (17249) - http://www.bohemiancoding.com/sketch --> <title>Shape</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="res-collection_Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" type="MSPage"> <path d="M94.25,26.5 C85.75,10.75 69.125,0 50.125,0 C22.625,0 0.375,22.375 0.375,50 C0.375,63.125 5.375,75 13.625,84 L90,160.75 C91.25,161.875 92.75,162.5 94.25,162.5 C95.75,162.5 97.25,161.875 98.5,160.75 L174.875,84 C183,75.125 188,63.125 188,50 C188,22.375 165.75,0 138.25,0 C119.375,0 102.875,10.75 94.25,26.5 Z M165.375,75.875 L94.25,148.125 L23.125,75.875 C16.75,69.125 12.875,60 12.875,50 C12.875,29.25 29.625,12.5 50.125,12.5 C66.75,12.5 81.125,23.5 86.125,38.625 C87.375,41.875 90.625,44.25 94.25,44.25 C98,44.25 101.125,42 102.5,38.75 L102.5,38.75 C107.375,23.5 121.625,12.5 138.25,12.5 C158.875,12.5 175.5,29.25 175.5,50 C175.625,60 171.75,69.125 165.375,75.875 L165.375,75.875 Z" id="res-collection_Shape" fill="#272636" type="MSShapeGroup"></path> </g> </symbol><symbol xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" viewBox="0 0 1024 1024" id="res-well"> <!-- Generator: Sketch 3.4.4 (17249) - http://www.bohemiancoding.com/sketch --> <title>Shape</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="res-well_Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" type="MSPage"> <path d="M512,0 C229.376,0 0,229.376 0,512 C0,794.624 229.376,1024 512,1024 C794.624,1024 1024,794.624 1024,512 C1024,229.376 794.624,0 512,0 L512,0 Z M247.808,402.432 C247.808,365.568 287.744,309.248 340.992,309.248 C394.24,309.248 434.176,365.568 434.176,402.432 C434.176,413.696 424.96,422.912 413.696,422.912 C402.432,422.912 393.216,413.696 393.216,402.432 C393.216,386.048 368.64,350.208 340.992,350.208 C313.344,350.208 288.768,386.048 288.768,402.432 C288.768,413.696 279.552,422.912 268.288,422.912 C257.024,422.912 247.808,413.696 247.808,402.432 L247.808,402.432 Z M512,800.768 C379.904,800.768 272.384,704.512 272.384,585.728 C272.384,574.464 281.6,565.248 292.864,565.248 C304.128,565.248 313.344,574.464 313.344,585.728 C313.344,681.984 402.432,759.808 512,759.808 C621.568,759.808 710.656,681.984 710.656,585.728 C710.656,574.464 719.872,565.248 731.136,565.248 C742.4,565.248 751.616,574.464 751.616,585.728 C751.616,703.488 644.096,800.768 512,800.768 L512,800.768 Z M755.712,422.912 C744.448,422.912 735.232,413.696 735.232,402.432 C735.232,385.024 710.656,350.208 683.008,350.208 C654.336,350.208 630.784,385.024 630.784,402.432 C630.784,413.696 621.568,422.912 610.304,422.912 C599.04,422.912 589.824,413.696 589.824,402.432 C589.824,365.568 629.76,309.248 683.008,309.248 C736.256,309.248 776.192,365.568 776.192,402.432 C776.192,413.696 766.976,422.912 755.712,422.912 L755.712,422.912 Z" id="res-well_Shape" fill="#7ED321" type="MSShapeGroup"></path> </g> </symbol><symbol xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" viewBox="0 0 1024 1024" id="res-ordinary"> <!-- Generator: Sketch 3.4.4 (17249) - http://www.bohemiancoding.com/sketch --> <title>Shape</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="res-ordinary_Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" type="MSPage"> <path fill="#febb00" class="path1 fill-color2" d="M670.476 454.548c33.663 0 60.952-27.019 60.952-60.349s-27.289-60.349-60.952-60.349c-33.663 0-60.952 27.019-60.952 60.349s27.289 60.349 60.952 60.349zM353.524 454.548c33.663 0 60.952-27.019 60.952-60.349s-27.289-60.349-60.952-60.349c-33.663 0-60.952 27.019-60.952 60.349s27.289 60.349 60.952 60.349zM0 508.862c0-279.97 226.941-506.931 506.938-506.931h10.125c279.974 0 506.938 226.899 506.938 506.931 0 279.97-226.941 506.931-506.938 506.931h-10.125c-279.974 0-506.938-226.899-506.938-506.931zM292.571 695.943c0 13.425 10.844 24.14 24.22 24.14h390.417c13.372 0 24.22-10.808 24.22-24.14 0-13.425-10.844-24.14-24.22-24.14h-390.417c-13.372 0-24.22 10.808-24.22 24.14z"></path> </g> </symbol><symbol xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" viewBox="0 0 1024 1024" id="res-x"> <!-- Generator: Sketch 3.4.4 (17249) - http://www.bohemiancoding.com/sketch --> <title>Shape</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="res-x_Page-1" stroke="none" stroke-width="1" fill-rule="evenodd" type="MSPage"> <path class="path1 fill-color3" d="M480.518 512l-472.141 472.141c-8.853 8.853-8.777 22.871-0.083 31.565 8.754 8.754 22.825 8.656 31.565-0.083l472.141-472.141 472.141 472.141c8.853 8.853 22.871 8.777 31.565 0.083 8.754-8.754 8.656-22.825-0.083-31.565l-472.141-472.141 472.141-472.141c8.853-8.853 8.777-22.871 0.083-31.565-8.754-8.754-22.825-8.656-31.565 0.083l-472.141 472.141-472.141-472.141c-8.853-8.853-22.871-8.777-31.565-0.083-8.754 8.754-8.656 22.825 0.083 31.565l472.141 472.141z"></path> </g> </symbol></defs></svg>
    <!--  svg2  -->
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:absolute;width:0;height:0;visibility:hidden"><defs><symbol viewBox="0 0 44 44" id="cart-add"><path fill-rule="evenodd" d="M22 0C9.8 0 0 9.8 0 22s9.8 22 22 22 22-9.8 22-22S34.2 0 22 0zm0 42C11 42 2 33 2 22S11 2 22 2s20 9 20 20-9 20-20 20z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M32 20c1.1 0 2 .9 2 2s-.9 2-2 2H12c-1.1 0-2-.9-2-2s.9-2 2-2h20z" clip-rule="evenodd"></path></symbol><symbol viewBox="0 0 44 44" id="cart-minus"><path fill="none" d="M0 0h44v44H0z"></path><path fill-rule="evenodd" d="M22 0C9.8 0 0 9.8 0 22s9.8 22 22 22 22-9.8 22-22S34.2 0 22 0zm10 24h-8v8c0 1.1-.9 2-2 2s-2-.9-2-2v-8h-8c-1.1 0-2-.9-2-2s.9-2 2-2h8v-8c0-1.1.9-2 2-2s2 .9 2 2v8h8c1.1 0 2 .9 2 2s-.9 2-2 2z" clip-rule="evenodd"></path></symbol><symbol viewBox="0 0 24 32" id="cart-remove"><path fill="#bbb" fill-rule="evenodd" d="M21.5 10h-19c-1.1 0-1.918.896-1.819 1.992l1.638 18.016C2.419 31.104 3.4 32 4.5 32h15c1.1 0 2.081-.896 2.182-1.992l1.637-18.016A1.798 1.798 0 0 0 21.5 10zM8 28H5L4 14h4v14zm6 0h-4V14h4v14zm5 0h-3V14h4l-1 14zm2-24h-2.941l-.353-2.514C17.592.669 16.823 0 15.998 0H8c-.825 0-1.593.668-1.708 1.486L5.94 4H3a3 3 0 0 0-3 3v1h24V7a3 3 0 0 0-3-3zM8.24 2h7.52l.279 2H7.96l.28-2z"></path></symbol><symbol viewBox="0 0 14 16" id="cart"><path fill="#FFF" fill-rule="evenodd" d="M12.364 2.998H2.088L1.816.687a.455.455 0 0 0-.478-.431L.431.303A.454.454 0 0 0 0 .78l1.256 10.893c.006.293.011 1.325.933 1.325h9.546a.455.455 0 0 0 .455-.454v-.881a.454.454 0 0 0-.455-.455H3.05l-.11-.937h8.606c.998 0 1.889-.724 1.989-1.616l.455-4.04c.1-.893-.628-1.617-1.626-1.617zm-.45 4.245c-.075.669-.317 1.212-1.066 1.212H2.727L2.3 4.812h8.821c.749 0 1.065.543.99 1.212l-.197 1.219zM2.416 15.79a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm9.092 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></symbol></defs></svg>
    <!--  svg-end -->
    <div>
      <div class="shopheader">
        <div class="shopheader-background"
             :style="{'background-image': 'url(https://fuss10.elemecdn.com'+ transImgUrl(shop.image_path) + '?imageMogr/quality/80/format/webp/thumbnail/!40p/blur/50x40/)'}"></div>
        <div class="shopheader-main">
          <img class="shopheader-logo" :src="shop.image_path | transformImgUrl(1) + '?imageMogr/quality/80/format/webp/'">
          <div class="shopheader-content">
            <h2 class="shopheader-name">{{ shop.name }}</h2>
            <p class="shopheader-servercontent">
              <span v-if="shop.delivery_mode" class="shopheader-server">{{ shop.delivery_mode.text }}</span>
              <span v-else class="shopheader-server">商家配送</span>
              <span v-if="shop.order_lead_time != 0" class="shopheader-server">{{ shop.order_lead_time }}分钟送达</span>
              <span class="shopheader-server">{{ shop.piecewise_agent_fee.tips }}</span>
            </p>
            <div class="shopheader-activities">
              <ul>
                <li>
                  <shop-activity :activity="activities[0]" type="activity"></shop-activity>
                </li>
              </ul>
              <div @click="active" class="shopheader-activity-count">
                {{ activities.length }}个活动
                <svg class="arrow">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#arrow-right"></use>
                </svg>
              </div>
            </div>
          </div>
        </div>
        <div @click="active" class="shopheader-notice">
          <span v-if="shop.promotion_info">{{ shop.promotion_info }}</span>
          <span v-else>欢迎光临，用餐高峰期请提前下单，谢谢。</span>
          <svg class="shopheader-notice-arrow">
            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#arrow-right"></use>
          </svg>
        </div>
      </div>
      <!--  商家公告  -->
      <shop-notice :shop="shop" v-if="showActive"></shop-notice>
    </div>
    <div class="shopbody" style="position: relative;">
      <div class="shopnav">
        <a @click="navTo(0)" class="shopnav-tab" :class="{'active': activeNav === 0}" href="javascript:">
          <span class="shopnav-title">商品</span>
        </a>
        <a @click="navTo(1)" class="shopnav-tab" :class="{'active': activeNav === 1}" href="javascript:">
          <span class="shopnav-title">商家</span>
        </a>
      </div>
      <keep-alive>
        <template v-if="activeNav === 0">
          <menu-view></menu-view>
        </template>
      </keep-alive>
      <keep-alive>
        <template v-if="activeNav === 1">
          <shop-info :ratings="ratings"></shop-info>
        </template>
      </keep-alive>
    </div>
    <!--  放置商家评价的两个空div  -->
    <div>
      <div>
        <shop-rate v-if="showRate"></shop-rate>
      </div>
    </div>
  </div>
</template>
<style scoped>
  .ui-ellipsis {
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
  /*  商家信息头部-start  */
  .shopheader {
    position: relative;
    height: 2.6rem;
    color: #fff;
    font-size: 0.293333rem;
  }
  .shopheader-background {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    background-color: #3190e8;
    -webkit-background-size: cover;
    background-size: cover;
    background-repeat: no-repeat;
  }
  .shopheader-background::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background-color: rgba(119, 103, 137, .43);
  }
  .shopheader-main {
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    height: 2.4rem;
    padding-top: 0.266667rem;
    position: fixed;
    top: 0;
    width: 100%;
    will-change: opacity;
  }
  .shopheader-logo {
    width: 1.546667rem;
    height: 1.546667rem;
    border: 1px solid #fff;
    -webkit-border-radius: 0.186667rem;
    border-radius: 0.186667rem;
    margin: 0 0.266667rem 0 0.466667rem;
  }
  .shopheader-content {
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    -ms-flex: 1;
    flex: 1;
    display: block;
    width: 0;
    height: 100%;
    padding-right: 0.133333rem;
  }
  .shopheader-content svg {
    width: 0.266667rem;
    height: 0.266667rem;
  }
  .shopheader-name {
    margin: 0;
    font-size: 0.466667rem;
    line-height: 0.466667rem;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .shopheader-servercontent {
    white-space: nowrap;
    height: 0.666667rem;
    line-height: 0.72rem;
  }
  .shopheader-activities {
    position: relative;
    padding-right: 1.6rem;
  }
  .shopheader-activities li {
    margin-bottom: 0.2rem;
    -webkit-transition: opacity .2s;
    transition: opacity .2s;
  }
  .shopheader-activity-count {
    position: absolute;
    top: 0;
    right: 0;
    height: 0.48rem;
    line-height: 0.506667rem;
    padding: 0 0.333333rem 0 0.106667rem;
    background-color: rgba(0, 0, 0, .15);
    -webkit-border-radius: 0.266667rem;
    border-radius: 0.266667rem;
  }
  .shopheader-activity-count .arrow {
    position: absolute;
    top: 0.106667rem;
    right: 0;
    height: 0.266667rem;
    width: 0.266667rem;
    fill: #fff;
  }
  .shopheader-server {
    line-height: 0.32rem;
  }
  .shopheader-server:not(:last-child)::after {
    content: ' / ';
    opacity: .5;
  }
  .shopheader-notice {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 0 0.533333rem 0 0.266667rem;
    height: 0.533333rem;
    line-height: 0.533333rem;
    background-color: rgba(0, 0, 0, .15);
    color: rgba(255, 255, 255, .8);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .shopheader-notice::before {
    content: '公告';
    display: inline-block;
    padding: 0 0.053333rem;
    height: 0.346667rem;
    line-height: 0.373333rem;
    background-color: rgba(255, 255, 255, .8);
    color: #666;
    -webkit-border-radius: 0.053333rem;
    border-radius: 0.053333rem;
    margin-right: 0.133333rem;
  }
  .shopheader-notice-arrow {
    position: absolute;
    top: 0.133333rem;
    right: 0;
    height: 0.266667rem;
    width: 0.4rem;
    fill: #fff;
  }
  /*  商家信息头部-end  */
  /*  shopnav-start  */
  .shopnav {
    line-height: 1.2rem;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    background-color: #fff;
  }
  .shopnav-tab {
    position: relative;
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    -ms-flex: 1;
    flex: 1;
    display: block;
    width: 0;
    text-align: center;
    font-size: 0.373333rem;
    color: #666;
    text-decoration: none;
    border-bottom: 1px solid #ddd;
  }
  .shopnav-tab.active {
    color: #3190e8;
  }
  .shopnav-tab.active .shopnav-title {
    position: relative;
  }
  .shopnav-tab.active .shopnav-title::after {
    content: "";
    position: absolute;
    bottom: -0.16rem;
    left: -0.066667rem;
    right: -0.066667rem;
    height: 0.053333rem;
    background-color: #3190e8;
    -webkit-border-radius: 0.04rem;
    border-radius: 0.04rem;
  }
  /*  shopnav-end  */
</style>
<script>
  import menuView from './menuView.vue'
  import shopInfo from './shopInfo.vue'
  import shopNotice from './shopNotice.vue'
  import shopRate from './shopRate.vue'
  import shopActivity from '../common/shopActivity.vue'
  export default{
    data () {
      return {
        activities: [], // 活动列表
        activeNav: 0, //  激活导航
        ratings: [], //  信息页最新一条评论
        infoLoaded: false,
      }
    },
    computed: {
      shop(){
        return this.$store.state.shop
      },
      showActive(){
        return this.$store.state.showActive
      },
      showRate(){
        return this.$store.state.showRate
      },
      license(){
        return this.$store.state.license
      }
    },
    methods: {
      loadShopMsg(){
        this.$http({url: 'eleme_api.php', params: {api_str: 'shopping/restaurant/'+ this.$route.params.shopId +'?extras[]=activities&extras[]=album&extras[]=license&extras[]=identification&extras[]=statistics&latitude=22.68403&longitude=114.21408'}}).then(function (res) {
          this.$store.commit('setShop', res.data)
          this.activities = res.data.activities
        })
      },
      loadMenuList(){
        //  获取菜单数据
        this.$http({url: 'eleme_api.php', params: {api_str: 'shopping/v2/menu?restaurant_id='+ this.$route.params.shopId}}).then(function (res) {
          this.$store.dispatch('shopMenuList', {
            list: res.data,
            shopId: this.$route.params.shopId
          })
        })
      },
      getRatingScores(){ // 获取商家评分评价信息
        this.$http({url: 'eleme_api.php', params: {api_str: 'ugc/v2/restaurants/'+ this.$route.params.shopId +'/ratings/scores'}}).then(function (res) {
          this.$store.commit('setRatingScores', res.data)
        })
      },
      active(){ //  激活显示活动信息以及公告
        window.history.pushState({notice: true}, document.title)
        this.$store.commit('setShowActive', true)
      },
      navTo(index){ // 导航到相应的商家食物列表或者商家信息
        if (index === this.activeNav){
          return
        }
        this.activeNav = index;
        //  信息页如果没有加载数据，就加载数据
        if (!this.infoLoaded && index === 1){
          this.getTags();
          this.getRatings();
        }
      },
      getRatings(){ // 获取商家最新一条评价
        this.$http({url: 'eleme_api.php', params: {api_str: 'ugc/v2/restaurants/'+ this.$route.params.shopId +'/ratings?has_content=1&limit=1'}}).then(function (res) {
          this.infoLoaded = true
          this.ratings = res.data
        })
      },
      getTags(){
        this.$http({url: 'eleme_api.php', params: {api_str: 'ugc/v2/restaurants/'+ this.$route.params.shopId +'/ratings/tags'}}).then(function (res) {
          this.infoLoaded = true
          if (res.data.length === 0) this.$store.commit('setTag', {});
          this.$store.commit('setTags', res.data)
        })
      },
      transImgUrl(path){
        var reg = /gif|jpe?g|png$/i; // 匹配图片后缀
        try {
          //  忽略一个数据未加载成功前path的值为undefined造成的错误
          var extension = path.match(reg)[0];
          var restfulUrl = '/' + path.substring(0, 1) + '/' + path.substring(1, 3) + '/' + path.substring(3)
          return restfulUrl + '.' + extension
        } catch (e){}
      },
    },
    created () {
      //  重置标签
      this.$store.commit('setTag', {})
      this.loadShopMsg()
      this.loadMenuList()
      this.getRatingScores();
    },
    mounted () {
      window.onpopstate = function (e) { //  注册浏览器回退事件
        if (this.showActive){
          this.$store.commit('setShowActive', false)
        }
        if (this.showRate){
          this.$store.commit('setShowRate', false)
        }
        if (this.license){
          this.$store.commit('setLicense', false)
        }
      }.bind(this)
    },
    components: {
      menuView, shopInfo, shopNotice, shopRate, shopActivity
    }
  }
</script>
